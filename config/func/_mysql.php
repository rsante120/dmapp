<?php 
// Validar conexión antes de ejecutar cualquier función
function check_connection() {
    global $cnx;
    if (!$cnx) {
        die("Error: No hay conexión a la base de datos.");
    }
}

//////////////////////////////////////////////////////////////////////////////////////////////////////
function mysql_num_rows($r){
    return mysqli_num_rows($r);
}
//////////////////////////////////////////////////////////////////////////////////////////////////////
function mysql_insert_id(){
    global $cnx; 
    check_connection();
    return mysqli_insert_id($cnx);
}
//////////////////////////////////////////////////////////////////////////////////////////////////////
function mysql_fetch_array($r){
    return mysqli_fetch_array($r, MYSQLI_ASSOC); // Siempre devolver un array asociativo por seguridad
}
//////////////////////////////////////////////////////////////////////////////////////////////////////
function mysql_fetch_row($r){
    return mysqli_fetch_row($r);
}
//////////////////////////////////////////////////////////////////////////////////////////////////////
function mysql_query($s){
    global $cnx;  
    check_connection();
    $res = mysqli_query($cnx, $s);
    if (!$res) {
        die("Error en la consulta: " . mysqli_error($cnx)); // Manejo básico de errores
    }
    return $res;
}
//////////////////////////////////////////////////////////////////////////////////////////////////////
function mysql_error(){
    global $cnx; 
    return mysqli_error($cnx);
} 
//////////////////////////////////////////////////////////////////////////////////////////////////////
function mysql_fetch_assoc($r){
    return mysqli_fetch_assoc($r);
}
//////////////////////////////////////////////////////////////////////////////////////////////////////
// Mejorar escape de cadenas con validación de conexión
function mysql_real_escape_string($valor){
    global $cnx; 
    check_connection();
    return mysqli_real_escape_string($cnx, $valor);
}
?>
